<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word to HTML</title>
    <script src="https://cdn.jsdelivr.net/npm/mammoth@1.4.8/mammoth.browser.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f7fc;
            min-height: 100vh;
            padding: 20px;
        }

        #main {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            width: 100%;
            max-width: 600px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group.multiple-items {
            display: flex;
            justify-content: space-between;
            gap: 1em;
        }

        label {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            display: block;
            margin-bottom: 8px;
        }

        input[type="text"],
        input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            color: #333;
        }

        input[type="text"]:focus,
        input[type="file"]:focus {
            border-color: #0066cc;
            outline: none;
        }

        button {
            background-color: #0066cc;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: inline-block;
        }

        button:hover {
            background-color: #005bb5;
        }

        .download-link {
            margin-top: 20px;
        }

        #reload {
            background-color: #28a745;
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            border: none;
            transition: background-color 0.3s;
            margin-top: 15px;
        }

        #reload:hover {
            background-color: #218838;
        }

        #submit {
            margin-top: 1em;
            margin-bottom: 1em;
        }

        #infoButton {
            background-color: orangered;
            color: black;
        }

        /* The Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            padding-top: 80px;
            transition: opacity 0.3s ease;
        }

        .modal-content {
            background-color: #fff;
            margin: auto;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            font-family: 'Arial', sans-serif;
            color: #333;
        }

        .modal-content h2 {
            font-size: 1.8em;
            margin-bottom: 20px;
            color: #007BFF;
        }

        .modal-content p {
            font-size: 1.1em;
            line-height: 1.6;
        }

        .modal-content ol {
            margin-left: 2em;
        }

        .modal-content li {
            margin-bottom: 1em;
        }

        #infoButton {
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <div id="main">
        <h1 id="converterType">IJEDE Converter</h1>

        <div class="form-group">
            <button type="button" id="infoButton" onclick="openModal()">Requirements</button>
        </div>

        <div class="form-group">
            <label for="title">File Name</label>
            <input type="text" id="title" required onkeyup="updateFileName()">
        </div>

        <div class="form-group">
            <label for="authors">Author Names</label>
            <input type="text" id="authors" required onkeyup="updateAuthorNames()">
        </div>

        <div class="form-group multiple-items">
            <div style="width: 70%;">
                <label for="doi">DOI Link</label>
                <input type="text" id="doi" onkeyup="updateDOI()">
            </div>

            <div>
                <label for="dimensions">Table Dimensions (1 or 2)</label>
                <input type="text" id="dimensions" onkeyup="updateTableDimensions()">
            </div>
        </div>

        <div class="form-group">
            <label for="imageCount">Number of Images</label>
            <input type="number" id="imageCount" min="0" onkeyup="updateImageCount()" onchange="updateImageCount()">
        </div>

        <div id="imageFilenamesContainer" style="display: none;">
            <label>Image Filenames:</label>
            <div id="imageFilenameInputs"></div>
        </div>

        <div class="form-group multiple-items">
            <div>
                <label for="volumeNo">Volume Number</label>
                <input type="text" id="volumeNo" onkeyup="updateVolumeNo()">
            </div>
            <div>
                <label for="issueNo">Issue Number</label>
                <input type="text" id="issueNo" onkeyup="updateIssueNo()">
            </div>
            <div>
                <label for="articleDate">Article Date</label>
                <input type="text" id="articleDate" onkeyup="updateArticleDate()">
            </div>
        </div>

        <div class="form-group">
            <input id="wordFile" type="file" accept=".docx" onchange="convertFile(this)">
            <button type="button" id="submit">Convert</button>
        </div>

        <div id="result" class="download-link"></div>
        <br />
        <button id="reload">Convert Another File</button>
    </div>

    <div id="requirementsModal" class="modal">
        <div class="modal-content">
            <h2>Formatting Requirements</h2>
            <p>Please make sure to read the following rules to ensure that your file is converted:</p><br />
            <li style="list-style: none;"><b><u>Rules</u></b></li>
            <ol type="I">
                <li>The document must have the following general heading structure:</li>
                <ol type="1">
                    <li>Introduction</li>
                    <li>References</li>
                    <li>Author(s)</li>
                    <li>Long Description(s)</li>
                    <li>Image Description(s)</li>
                </ol>
                <li>
                    Not all of the headers above have to be present, but if they are they need to be in this order.
                    Otherwise, the converter will throw an error and it will not convert the document.
                </li>

            </ol>
        </div>
    </div>
    <script>
        // ------------------------------------------------------------------------------------------------------------------------------------------------
        // *************************** This section contains functions that focus exclusively on the main page of the converter ***************************
        // ------------------------------------------------------------------------------------------------------------------------------------------------
        var fileName = "";
        var names = "";
        var tableDimensions = "";
        var volumeNo = "";
        var issueNo = "";
        var articleDate = "";
        var doiLink = "";
        var imageFileNames = [];
        var imageCount = 0;

        // Function to open the modal
        function openModal() {
            document.getElementById("requirementsModal").style.display = "block";
        }

        // Function to close the modal
        function closeModal() {
            document.getElementById("requirementsModal").style.display = "none";
        }

        // Close the modal when the user clicks anywhere outside of the modal content
        window.onclick = function (event) {
            if (event.target == document.getElementById("requirementsModal")) {
                closeModal();
            }
        }

        // Reloads the page
        document.getElementById("reload").addEventListener("click", function () {
            window.location.reload();
        });

        // Updates the authors names as the user types into the input box
        function updateAuthorNames() {
            names = document.getElementById("authors").value;
        }

        // Updates the file name as the user types into the input box
        function updateFileName() {
            fileName = document.getElementById("title").value;
        }

        // Updates the table dimensions as the user types into the input box
        function updateTableDimensions() {
            tableDimensions = document.getElementById("dimensions").value;
        }

        // Updates the volume number as the user types into the input box
        function updateVolumeNo() {
            volumeNo = document.getElementById("volumeNo").value;
        }

        // Updates the issue number as the user types into the input box
        function updateIssueNo() {
            issueNo = document.getElementById("issueNo").value;
        }

        // Updates the article date as the user types into the input box
        function updateArticleDate() {
            articleDate = document.getElementById("articleDate").value;
        }

        // Updates the article date as the user types into the input box
        function updateDOI() {
            doiLink = document.getElementById("doi").value;
        }

        // Updates the count of images in the document
        function updateImageCount() {
            imageCount = parseInt(document.getElementById("imageCount").value) || 0;
            const container = document.getElementById("imageFilenamesContainer");
            const inputsDiv = document.getElementById("imageFilenameInputs");

            if (imageCount > 0) {
                container.style.display = "block";

                // Clear existing inputs
                inputsDiv.innerHTML = "";

                // Create input fields for each image
                for (let i = 0; i < imageCount; i++) {
                    const inputGroup = document.createElement("div");
                    inputGroup.style.marginBottom = "10px";

                    const label = document.createElement("label");
                    label.textContent = `Image ${i + 1} filename:`;
                    label.style.display = "inline-block";
                    label.style.width = "150px";
                    label.style.fontSize = "14px";
                    label.style.fontWeight = "normal";

                    const input = document.createElement("input");
                    input.type = "text";
                    input.id = `imageFilename${i}`;
                    input.placeholder = `e.g., figure${i + 1}.png`;
                    input.style.width = "calc(100% - 160px)";
                    input.onkeyup = function () { updateImageFilenames(); };

                    inputGroup.appendChild(label);
                    inputGroup.appendChild(input);
                    inputsDiv.appendChild(inputGroup);
                }
            } else {
                container.style.display = "none";
                imageFileNames = [];
            }
        }
        // Updates the image filenames as the user types into the input box
        function updateImageFilenames() {
            imageFileNames = [];
            for (let i = 0; i < imageCount; i++) {
                const input = document.getElementById(`imageFilename${i}`);
                if (input && input.value.trim() !== "") {
                    imageFileNames[i] = input.value.trim();
                } else {
                    imageFileNames[i] = `image_${i + 1}.png`; // Default fallback
                }
            }
        }


        // *************************** START OF FUNCTION ***************************
        function convertFile(input) {
            var file = input.files[0];
            var reader = new FileReader();

            // Custom Formatting from Word to HTML. The stylemap from mammoth.js can convert non-standard styles and
            // converts them into whatever you specify. Read the docs for more details about this.
            var options = {
                styleMap: [
                    "p[style-name='Heading 7'] => blockquote:fresh", // Heading 7 is converted to a blockquote
                    "p[style-name='Quote'] => blockquote:fresh", // Quote is converted to a blockquote
                    "p[style-name='Title'] => h1" // Title is converted to h1
                ]
            };

            // Mammoth.js converter
            reader.onloadend = function () {
                mammoth.convertToHtml({ arrayBuffer: reader.result }, options)
                    .then(function (result) {
                        /* ----- Here is where the HTML modifiction begins ----- */
                        let output = result.value;

                        // Formats the HTML string
                        output = formatOutput(output);

                        // Outputs the HTML into a downloadable file
                        document.getElementById("submit").addEventListener("click", function () {
                            var blob = new Blob([output], { type: 'text/html' });
                            var url = URL.createObjectURL(blob);
                            var a = document.createElement('a'); // Creates the download link
                            a.href = url;
                            a.download = fileName + '.html';
                            a.textContent = 'Download ' + fileName + '.html';

                            // Download link styling
                            a.style.padding = "1em";
                            a.style.borderRadius = "0.25em";
                            a.style.border = "1px solid black";
                            a.style.textDecoration = "none";

                            document.getElementById('result').innerHTML = '';
                            document.getElementById('result').appendChild(a);
                        });
                    });
            };
            reader.readAsArrayBuffer(file);

            // Disables all inputs to ensure the user refreshes the page
            document.getElementById("title").disabled = "true";
            document.getElementById("authors").disabled = "true";
            document.getElementById("dimensions").disabled = "true";
            document.getElementById("wordFile").disabled = "true";
            document.getElementById("volumeNo").disabled = "true";
            document.getElementById("issueNo").disabled = "true";
            document.getElementById("articleDate").disabled = "true";
            document.getElementById("doi").disabled = "true";
            document.getElementById("imageCount").disabled = "true";

            // Disable all image filename inputs
            for (let i = 0; i < imageCount; i++) {
                const input = document.getElementById(`imageFilename${i}`);
                if (input) {
                    input.disabled = "true";
                }
            }
        }
        // *************************** END OF FUNCTION ***************************



        // *************************** START OF FUNCTION ***************************
        function formatOutput(HTMLstring) {
            let output = HTMLstring;

            output = formatTables(output);

            output = formatTags(output);
            if (output === -1) {
                console.error("File could not format tags.");
                return -1;
            }

            output = formatAuthors(output);

            output = formatHeaderAndCC(output);

            output = addAdditionalChanges(output);

            return output;
        }
        // *************************** END OF FUNCTION ***************************



        // ----------------------------------------------------------------------------------------------------------------------------------------------
        // *************************** This section contains functions that focus exclusively on manipulating the HTML string ***************************
        // ----------------------------------------------------------------------------------------------------------------------------------------------

        // *************************** START OF FUNCTION ***************************
        function formatTables(htmlString) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlString, 'text/html'); // Makes a DOM out of the HTML string

            // Adds a title for each image and copies the text from the 'alt' attribute
            const images = doc.querySelectorAll('img');

            images.forEach((image, index) => {
                image.title = image.alt;

                // Check if the src is base64 and replace with user-provided filename
                if (image.src.startsWith('data:image/')) {
                    // Use the user-provided filename if available
                    if (imageFileNames[index]) {
                        image.src = imageFileNames[index];
                    } else {
                        // Fallback to sequential numbering
                        image.src = `image_${index + 1}.png`;
                    }

                    // Add a data attribute to track original base64 if needed
                    image.setAttribute('data-original-base64', 'true');
                }
            });

            const tables = doc.querySelectorAll("table"); // Selects all tables in the newly created DOM

            // Places all the captions within the table HTML
            tables.forEach((table, index) => {
                const caption = table.previousElementSibling;
                const captionCreated = doc.createElement("caption");
                const colon = caption.textContent.indexOf(":");
                // Extra if tables aren't labelled, add: <strong>Table ${index + 1}. </strong>, to before the <i> in the line below
                captionCreated.innerHTML = `<strong>Table ${index + 1}. </strong><i>${caption.textContent.substring(colon + 1)}</i>`; // Creates the caption text
                caption.remove();
                table.appendChild(captionCreated);

                // Makes an array of table rows for each table
                const rows = table.rows;

                // Base table styling
                table.style.width = "80%";
                table.style.marginLeft = "auto";
                table.style.marginRight = "auto";
                table.style.borderSpacing = "0";

                // Row setting
                const firstRow = 0;
                const lastRow = rows.length - 1;
                const firstCell = 0;

                // Main loop that styles the rows and cells of each table. If you want to target a specific table, 
                // use an if statement in the innermost loop and reference the 'index' variable.
                for (let i = 0; i < rows.length; i++) {
                    const row = rows[i];

                    // Makes an array of table cells for each row
                    const cells = row.cells;

                    // Style cells in each row
                    for (let j = 0; j < cells.length; j++) {
                        const cell = cells[j];

                        // Style for all cells
                        cell.style.padding = "5px";

                        // Text the first cell in each row
                        if (j === 0) {
                            cell.style.textAlign = "left";
                        } else {
                            cell.style.textAlign = "right";
                        }

                        // Styles the first and last row of each table
                        if (i === firstRow || i === lastRow) {
                            cell.style.borderBottom = "1px solid black";  // Bottom border for first and last rows
                        } else {
                            cell.style.borderBottom = "1px solid black";  // Bottom border for all other rows
                        }

                        // Remove paragraph wrapper if it exists
                        const p = cell.querySelector("p");
                        if (p) {
                            cell.textContent = p.textContent;
                        }

                        // Styles the first cell of each row for two-dimentional tables
                        if (j === firstCell && tableDimensions == 2) {
                            cell.style.color = "#00759E";  // Color for first cell of each row
                        }

                        // ----------------------------- ADD IN ANY EXTRA/SPECIFIC CODE BELOW THIS -----------------------------




                    }

                    // Special handling for header row
                    if (i === firstRow) {
                        const firstRowCells = row.cells;
                        for (let cell of firstRowCells) { // Styles each cell of the first row
                            cell.style.backgroundColor = "white";
                            cell.style.color = "#00759E";
                            cell.style.textAlign = "center";

                            // Convert td to th if needed
                            if (cell.tagName.toLowerCase() !== "th") {
                                const th = doc.createElement("th");
                                th.innerHTML = cell.innerHTML;
                                Array.from(cell.attributes).forEach((attr) => {
                                    th.setAttribute(attr.name, attr.value);
                                });
                                cell.parentNode.replaceChild(th, cell);
                            }
                        }
                    } else { // For all other rows
                        row.style.color = "#000000";
                    }
                }
            });

            return doc.documentElement.outerHTML;
        }
        // *************************** END OF FUNCTION ***************************



        // *************************** START OF FUNCTION ***************************
        function formatTags(output) {

            // Adds stylesheet
            let headHTML = `<head><meta charset="UTF-8"><link rel="stylesheet" href="styles.css" type="text/css" /></head>`;
            output = output.replace("<body>", `${headHTML}<body>`);

            // Adds CC caption to the end of the document
            output = output.replace(`<//body>`, `CC IMAGE CAPTION<//body>`);

            // Mammoth.js auto-generates a tags with (id's == "_heading=...") if the Word document went through Google Docs at some point, so the next few lines remove them
            output = output.replaceAll(/<a[^>]*id="_heading[^"]*"[^>]*><\/a>/g, ``);
            output = output.replaceAll(/<a[^>]*id="_(heading|Hlk)[^"]*"[^>]*><\/a>/g, '');

            // Adds header before the first h1 header
            output = output.replace("<h1>", "<div>HEADER CAPTION</div><h1>");

            // Changes English title to its proper size
            let enlargeHeaders = 1;
            output = output.replace(`<h1>`, `<p class="titles">`);
            output = output.replace("</h1>", "</p>");

            // *************************** START OF SUBSECTION ***************************
            // This subsection allocates the critical junctions (or indeces) between each 
            // major section (Introduction, References, etc) to their variables below.

            // Note. If a new case occurs in an article, add:
            // (1) A new index variable
            // (2) A new 'Point X' to add to the new index variable following the general 
            //     format of the previous points

            // Index variables
            let introductionIndex,
                referencesIndex,
                authorsIndex,
                longDescriptionIndex,
                imageDescriptionIndex,
                endNotesIndex = 0;

            let indexExistsArray = [];

            // Point 1
            // -------------------------------------------------------------------------------------------------------------------------

            introductionIndex = output.indexOf("<h1>Introduction");
            if (introductionIndex === -1) {
                introductionIndex = output.indexOf("<h1>Background");
                if (introductionIndex !== -1) {
                    indexExistsArray.push({ name: "Introduction", index: introductionIndex });
                }
            } else {
                indexExistsArray.push({ name: "Introduction", index: introductionIndex });
            }

            // Point 2
            // -------------------------------------------------------------------------------------------------------------------------

            referencesIndex = output.indexOf("<h1>References");
            if (referencesIndex !== -1) {
                indexExistsArray.push({ name: "References", index: referencesIndex });
            }

            // Point 3
            // -------------------------------------------------------------------------------------------------------------------------

            authorsIndex = output.indexOf("<h1>Author");
            if (authorsIndex === -1) {
                authorsIndex = output.indexOf("<h1>Authors");
            }
            if (authorsIndex !== -1) {
                indexExistsArray.push({ name: "Authors", index: authorsIndex });
            }
            // Point 4
            // -------------------------------------------------------------------------------------------------------------------------

            longDescriptionIndex = output.indexOf("<h1>Long Description");
            if (longDescriptionIndex === -1) {
                longDescriptionIndex = output.indexOf("<h1>Long Descriptions");
            }
            if (longDescriptionIndex !== -1) {
                indexExistsArray.push({ name: "Long Descriptions", index: longDescriptionIndex });
            }

            // Point 5
            // -------------------------------------------------------------------------------------------------------------------------

            imageDescriptionIndex = output.indexOf("<h1>Image Description");
            if (imageDescriptionIndex === -1) {
                imageDescriptionIndex = output.indexOf("<h1>Image Descriptions");
            }
            if (imageDescriptionIndex !== -1) {
                indexExistsArray.push({ name: "Image Descriptions", index: imageDescriptionIndex });
            }

            // Point 6
            // -------------------------------------------------------------------------------------------------------------------------

            endNotesIndex = output.indexOf(`<ol><li id="footnote-1">`);
            if (endNotesIndex !== -1) {
                indexExistsArray.push({ name: "End Notes", index: endNotesIndex });
            }

            // Sorts array so that the indeces are in sequential order by index value
            indexExistsArray.sort((a, b) => a.index - b.index);

            // Prints each item in the array
            for (let i in indexExistsArray) {
                console.log(indexExistsArray[i]);
            }

            // Handle empty array - if no headers found, just return the output as-is
            if (indexExistsArray.length === 0) {
                console.log("No section headers found. Processing document as-is.");
                output = output.replaceAll(`<p>`, `<p class="main-content">`);
                return output;
            }
            // *************************** END OF SUBSECTION ***************************

            // *************************** START OF SUBSECTION ***************************
            // This subsection splits the initial HTML string into critical sections, and
            // allocates them to their subsequent variables.

            // Note. If there is another section that arises in a future article that isn't
            // covered by this code, you will have to do the following:
            // (1) Create a new section variable
            // (2) Create another case in the switch statement in the for-loop below, 
            //     following the general format.

            // Section variables
            let sections = {
                beginning: "",
                mainContent: "",
                references: "",
                authors: "",
                longDescriptions: "",
                imageDescriptions: "",
                endNotes: ""
            };

            // Extract sections dynamically based on what exists
            for (let i = 0; i < indexExistsArray.length; i++) {
                let currentName = indexExistsArray[i].name;
                let currentIndex = indexExistsArray[i].index;
                let nextIndex = (i < indexExistsArray.length - 1) ? indexExistsArray[i + 1].index : output.length;

                let sectionContent = output.substring(currentIndex, nextIndex);

                switch (currentName) {
                    case "Introduction":
                        // Everything before Introduction is the beginning
                        sections.beginning = output.substring(0, currentIndex);
                        sections.mainContent = sectionContent;
                        break;
                    case "References":
                        sections.references = sectionContent;
                        break;
                    case "Authors":
                        sections.authors = sectionContent;
                        break;
                    case "Long Descriptions":
                        sections.longDescriptions = sectionContent;
                        break;
                    case "Image Descriptions":
                        sections.imageDescriptions = sectionContent;
                        break;
                    case "End Notes":
                        // Process End Notes section
                        let endNotesEnd = sectionContent.indexOf("</li></ol>") + 10;
                        if (endNotesEnd > 9) {
                            sections.endNotes = sectionContent.substring(0, endNotesEnd);
                            sections.endNotes = "<h1>End Notes</h1>" + sections.endNotes.substring(sections.endNotes.indexOf("<ol>"));
                        } else {
                            sections.endNotes = sectionContent;
                        }
                        break;
                }
            }

            // If no Introduction section was found, treat everything up to first section as main content
            if (!indexExistsArray.some(item => item.name === "Introduction") && indexExistsArray.length > 0) {
                sections.beginning = output.substring(0, indexExistsArray[0].index);
                sections.mainContent = "";
            }

            // Format each section

            // Beginning text
            if (sections.beginning) {
                sections.beginning = sections.beginning.replace(`Abstract:`, `<strong id="abstract">Abstract:</strong>`);
                sections.beginning = sections.beginning.replace(`Keywords:`, `<em><strong id="keywords">Keywords: </strong></em>`);
                sections.beginning = sections.beginning.replace(`Resume :`, `<strong id="resume">Resume :</strong>`);
                sections.beginning = sections.beginning.replace(`Mots-cles :`, `<strong id="mot-cles">Mots-cles :</strong>`);
                sections.beginning = sections.beginning.replaceAll(`<p>`, `<p class="beginning-text">`);
            }

            // Main content
            if (sections.mainContent) {
                sections.mainContent = sections.mainContent.replaceAll("<p>", '<p class="main-content">');
                sections.mainContent = sections.mainContent.replaceAll(`<table`, `<br><table`);
                sections.mainContent = sections.mainContent.replaceAll(`</table>`, `</table><br>`);
            }

            // References
            if (sections.references) {
                let individualReferences = sections.references.split("</p>");
                let fixedReferences = individualReferences.map((i) =>
                    '<div class="individual-references">' + i + '</p></div>'
                );
                sections.references = fixedReferences.join("");
                sections.references = sections.references.replaceAll(`<p>`, `<p class="reference">`);
            }

            // Authors
            if (sections.authors) {
                sections.authors = sections.authors.replaceAll(`<p>`, `<p class="authors">`);
            }

            // Long Descriptions
            if (sections.longDescriptions) {
                sections.longDescriptions = sections.longDescriptions.replaceAll(`<p>`, `<p class="long_descriptions">`);
            }

            // Image Descriptions
            if (sections.imageDescriptions) {
                sections.imageDescriptions = sections.imageDescriptions.replaceAll(`<p>`, `<p class="image_descriptions">`);
            }

            // End Notes
            if (sections.endNotes) {
                sections.endNotes = sections.endNotes.replaceAll(`<ol>`, `<ol id="end_notes">`);

                const parser2 = new DOMParser();
                const doc2 = parser2.parseFromString(sections.endNotes, 'text/html');
                const listItems = doc2.querySelectorAll('li');
                let numOfEndNotes = listItems.length;

                for (let i = 1; i <= numOfEndNotes; i++) {
                    sections.endNotes = sections.endNotes.replace(`<a href="#footnote-ref-${i}">â†‘`, `<a href="#footnote-ref-${i}"><sup>${i}</sup>`);
                }
            }

            // Build output with dividers only between existing sections
            let hrText = `<hr color="#00759E" size="2" width="75%">`;
            let outputParts = [sections.beginning, sections.mainContent];

            if (sections.references) {
                outputParts.push(hrText, sections.references);
            }
            if (sections.authors) {
                outputParts.push(hrText, sections.authors);
            }
            if (sections.longDescriptions) {
                outputParts.push(sections.longDescriptions);
            }
            if (sections.imageDescriptions) {
                outputParts.push(sections.imageDescriptions);
            }
            if (sections.endNotes) {
                outputParts.push(sections.endNotes);
            }

            output = outputParts.join("");

            return output;
        }
        // *************************** END OF FUNCTION ***************************



        // *************************** START OF FUNCTION ***************************
        // Formats the Author name(s)
        function formatAuthors(output) {
            let error = 0;

            let wordArray = [];
            let oneAuthor = "";
            let multipleAuthors = "";

            wordArray = names.split(", ");

            if (names.includes("and")) {
                wordArray = names.split(" and ");
            }

            // Reformats the author(s) at the top of the document
            output = output.replace(`${names}`, `<p id="authors_top">${names}</p><br><p id="article_details">ISSN: 2819-7046 - Volume ${volumeNo}, Issue ${issueNo}, ${articleDate}</p><p id="doi_link">${doiLink}</p>`);

            if (wordArray.length === 1) { // Checks if there are multiple authors since the split() method returns the original string if it cannot find any occurances
                output = output.replace(`<p class="authors">${names}`, `<p class="authors"><span id="authors_name">${names}</span>`); // Bolds author names
            } else {
                for (let i = 0; i < wordArray.length; i++) { // Gets rid of the 'and' before the last author so that it's easier to bold each name in the Author's section
                    if (wordArray[i].includes("and ")) {
                        wordArray[i] = wordArray[i].replace("and ", "");
                    }
                    output = output.replace(`<p class="authors">${wordArray[i]}`, `<p class="authors"><span id="authors_name">${wordArray[i]}</span>`);
                }
            }

            return output;
        }
        // *************************** END OF FUNCTION ***************************



        // *************************** START OF FUNCTION ***************************
        // Adds header content and Creative Commons (CC) license image to the document.
        function formatHeaderAndCC(output) {
            //Handle CC
            let splitCC = output.split("CC IMAGE CAPTION");
            if (splitCC[0] != output) {
                let imageAdded = splitCC[0] +
                    `<br><hr color='#72A376' size='2' width='75%'><div id='cc_image_caption'><br><img src="cc_image.png" width="205" height="relative" alt="This work is licensed under a Creative Commons Attribution 3.0 Unported License" title="This work is licensed under a Creative Commons Attribution 3.0 Unported License"> <p align="center">This work is licensed under a Creative Commons <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en">Attribution-NonCommercial-ShareAlike 4.0 International license </a><br><i>https://publishing.bceln.ca/index.php/future-earth/article/view/576/507</i></p></div>`;

                output = imageAdded + splitCC[1];
            } else {
                console.log("There were no image captions.");
            }

            //Handle Header
            let captionCC = output.split("HEADER CAPTION");
            if (captionCC[0] != output) {
                let imageAdded = captionCC[0] +
                    `<div id='header_img'> <img src="header_image.png" width="800" height="relative" alt="Future Earth: A Student Journal on Sustainability and Environment" title="Future Earth: A Student Journal on Sustainability and Environment"></div><h3>Test</h3>`;

                output = imageAdded + captionCC[1];
            } else {
                console.log("There were no header captions.");
            }

            return output;
        }
        // *************************** END OF FUNCTION ***************************


        // *************************** START OF FUNCTION ***************************
        // Adds any additional changes to the document.
        function addAdditionalChanges(output) {
            // console.log(output)

            // Example.
            // let numOfImages = 0;
            // for (let i = 0; i < numOfImages; i++) {
            //     output = output.replaceAll(`<p class="main-content normal"><a id="Fig${i + 1}"`, `<p class="main-content figures"><a id="Fig${i + 1}"`);
            //     output = output.replaceAll(`<p class="main-content normal"><a href="#Fig${i + 1}ImageDesc"`, `<p class="main-content img-desc"><a href="#Fig${i + 1}ImageDesc"`);
            // }

            return output;
        }
        // *************************** END OF FUNCTION ***************************

        // ----------------------------------------------------------------------
        // *************************** END OF SECTION ***************************
        // ----------------------------------------------------------------------
    </script>
</body>

</html>